{% extends "base.html" %}
{% block title %}Search Results{% endblock %}

{% block styles %}
<style>
    .search-header {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
        color: rgb(75, 130, 240);
        padding: 2rem;
        border-radius: var(--border-radius);
        margin-bottom: 2rem;
        box-shadow: var(--shadow-large);
    }

    .result-section {
        margin-bottom: 2.5rem;
    }

    .result-section-title {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--primary-blue);
    }

    .result-section-title i {
        font-size: 1.5rem;
        margin-right: 0.75rem;
        color: var(--primary-blue);
    }

    .result-card {
        background: rgba(246, 248, 249, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(74, 144, 226, 0.2);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-medium);
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: var(--transition);
        color: #2c3e50;
    }

    .result-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-large);
        background: rgb(240, 241, 243);
    }

    .result-card h5,
    .result-card h6 {
        color: #1a202c;
        font-weight: 600;
    }

    .result-meta {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 0.75rem;
        font-size: 0.9rem;
        color: #4a5568;
    }

    .result-meta span {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .highlight {
        background-color: #fbbf24;
        color: #1a202c;
        padding: 0.15rem 0.35rem;
        border-radius: 3px;
        font-weight: 600;
    }

    .badge-custom {
        padding: 0.35rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .no-results {
        text-align: center;
        padding: 3rem;
        color: #4a5568;
    }

    .no-results i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .result-actions {
        margin-top: 1rem;
        display: flex;
        gap: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="search-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h2><i class="fas fa-search me-2"></i>Search Results</h2>
            <p class="mb-0">Searching for: <strong>"{{ query }}"</strong></p>
        </div>
        <div class="text-end">
            <h3 class="mb-0">{{ total_results }}</h3>
            <small>Total Results</small>
        </div>
    </div>
</div>

{% if total_results == 0 %}
<div class="result-card no-results">
    <i class="fas fa-search"></i>
    <h4>No results found</h4>
    <p class="text-muted">Try different keywords or check your spelling.</p>
    <a href="{{ url_for('views.dashboard') }}" class="btn btn-primary mt-3">
        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
    </a>
</div>
{% else %}

<!-- Journal Entries Results -->
{% if journal_results %}
<div class="result-section">
    <h3 class="result-section-title">
        <i class="fas fa-book-medical"></i>
        Journal Entries ({{ journal_results|length }})
    </h3>
    {% for entry in journal_results %}
    <div class="result-card">
        <h5 class="text-primary">{{ entry.title }}</h5>
        <p class="mb-2">{{ entry.content[:200] }}{% if entry.content|length > 200 %}...{% endif %}</p>
        <div class="result-meta">
            <span>
                <i class="fas fa-calendar text-muted"></i>
                {{ entry.created_at.strftime('%B %d, %Y') }}
            </span>
            <span>
                <i class="fas fa-exclamation-circle text-muted"></i>
                <span class="badge 
                    {% if entry.severity == 'High' %}bg-danger
                    {% elif entry.severity == 'Medium' %}bg-warning
                    {% else %}bg-success{% endif %}">
                    {{ entry.severity }}
                </span>
            </span>
        </div>
        <div class="result-actions">
            <a href="{{ url_for('views.edit_journal', entry_id=entry.id) }}" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-pen me-1"></i>View/Edit
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Visits Results -->
{% if visit_results %}
<div class="result-section">
    <h3 class="result-section-title">
        <i class="fas fa-stethoscope"></i>
        Doctor's Visits ({{ visit_results|length }})
    </h3>
    {% for visit in visit_results %}
    <div class="result-card">
        <h5 class="text-primary">{{ visit.reason }}</h5>
        {% if visit.doctor_name %}
        <p class="mb-1"><strong>Doctor:</strong> Dr. {{ visit.doctor_name }}</p>
        {% endif %}
        {% if visit.diagnosis %}
        <p class="mb-2"><strong>Diagnosis:</strong> {{ visit.diagnosis[:150] }}{% if visit.diagnosis|length > 150
            %}...{% endif %}</p>
        {% endif %}
        <div class="result-meta">
            <span>
                <i class="fas fa-calendar text-muted"></i>
                {{ visit.visit_date.strftime('%B %d, %Y') }}
            </span>
        </div>
        <div class="result-actions">
            <a href="{{ url_for('views.visit_detail', visit_id=visit.id) }}" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-eye me-1"></i>View Details
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Medications Results -->
{% if medication_results %}
<div class="result-section">
    <h3 class="result-section-title">
        <i class="fas fa-pills"></i>
        Medications ({{ medication_results|length }})
    </h3>
    {% for medication in medication_results %}
    <div class="result-card">
        <h5 class="text-primary">{{ medication.name }}</h5>
        <div class="mb-2">
            {% if medication.dosage %}
            <span class="me-3"><strong>Dosage:</strong> {{ medication.dosage }}</span>
            {% endif %}
            {% if medication.frequency %}
            <span><strong>Frequency:</strong> {{ medication.frequency }}</span>
            {% endif %}
        </div>
        {% if medication.notes %}
        <p class="text-muted mb-2"><strong>Notes:</strong> {{ medication.notes[:100] }}{% if medication.notes|length >
            100 %}...{% endif %}</p>
        {% endif %}
        <div class="result-actions">
            <a href="{{ url_for('views.medications') }}" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-pills me-1"></i>View All Medications
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Documents Results -->
{% if document_results %}
<div class="result-section">
    <h3 class="result-section-title">
        <i class="fas fa-file-alt"></i>
        Documents ({{ document_results|length }})
    </h3>
    {% for document in document_results %}
    <div class="result-card">
        <h5 class="text-primary">
            <i class="fas fa-file-{% if document.filename.endswith('.pdf') %}pdf{% else %}image{% endif %} me-2"></i>
            {{ document.filename }}
        </h5>
        <div class="result-meta">
            <span>
                <i class="fas fa-calendar text-muted"></i>
                Uploaded: {{ document.upload_date.strftime('%B %d, %Y') }}
            </span>
        </div>
        <div class="result-actions">
            <a href="{{ url_for('views.documents') }}" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-folder-open me-1"></i>View All Documents
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="text-center mt-5">
    <a href="{{ url_for('views.dashboard') }}" class="btn btn-primary">
        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
    </a>
</div>

{% endif %}
{% endblock %}